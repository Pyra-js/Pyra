# CLI

Pyra's command-line interface is the front door to the entire toolchain. It's how you scaffold apps, run a dev server with instant HMR, produce optimized builds, and serve production output locally. This page covers every command, the shared flags that apply across them, and practical examples for day-to-day development and CI pipelines.

## Getting the CLI

The CLI is provided by the `pyrajs-cli` package, which exposes the `pyra` binary. The fastest way to get started is by scaffolding a new project — this installs the CLI as a dev dependency automatically:

```bash
# scaffold a new project (recommended)
npm create pyra@latest
pnpm create pyra@latest
yarn create pyra
bun create pyra
```

You can also install the CLI globally, or add it as a dev dependency to an existing project:

```bash
# global install
npm i -g pyrajs-cli
pyra dev

# project-local install
npm i -D pyrajs-cli
npx pyra dev
```

In team settings, keeping `pyrajs-cli` as a dev dependency and using `package.json` scripts ensures everyone runs the same version:

```json
{
  "scripts": {
    "dev": "pyra dev",
    "build": "pyra build",
    "start": "pyra start"
  }
}
```

When you run a command, Pyra treats the current directory as the project root. It searches for a config file (such as `pyra.config.ts`) and merges it with defaults and any CLI flags you pass. If no config file is found, Pyra proceeds with sensible defaults so you can develop and build without any boilerplate configuration.

## Global Options

These options work across multiple commands:

| Option | Description |
|--------|-------------|
| `--silent` | Suppress banners, timing output, and non-essential logs. Also respects the `PYRA_SILENT=1` environment variable. |
| `-c, --config <path>` | Point to a specific config file instead of relying on auto-discovery. |
| `-h, --help` | Show help for any command. |
| `-V, --version` | Print the CLI version. |

CLI flags always override your config file, which in turn overrides Pyra's built-in defaults. This makes it easy to tweak behavior in CI or scripted builds without touching your config.

```bash
# suppress all output in CI
PYRA_SILENT=1 pyra build

# or with the flag
pyra build --silent

# point to a specific config file
pyra dev --config ./config/pyra.config.ts
```

## Scaffolding

Pyra has two ways to start a new project, each designed for a different situation.

### npm create pyra — the official onboarding path

The `create-pyra` package is a lightweight, standalone scaffolder. It doesn't require the Pyra CLI to be installed — npm downloads it on the fly, runs the interactive wizard, and creates a new project directory for you.

```bash
npm create pyra@latest
pnpm create pyra@latest
yarn create pyra
bun create pyra
```

You can also pass a project name directly:

```bash
npm create pyra@latest my-app
```

This always creates a **new directory**. It never touches your current directory. The wizard walks you through every choice:

- **Project name** — the directory to create
- **Framework** — Vanilla or React
- **Language** — TypeScript or JavaScript
- **Tailwind CSS** — None, Basic, or shadcn (with design tokens and dark mode)
- **Package manager** — npm, pnpm, yarn, or bun (auto-detected by default)
- **Install dependencies** — yes or no

After scaffolding, it installs dependencies and prints your next steps:

```
Next steps:
  cd my-app
  pnpm dev
```

You can skip some prompts with flags:

| Option | Description |
|--------|-------------|
| `--pm <manager>` | Package manager to use: `npm`, `pnpm`, `yarn`, or `bun` |
| `--skip-install` | Skip automatic dependency installation |

This is the recommended starting point for new users. The `create-pyra` package is tiny (~8 KB compressed, ~1.5 MB with dependencies) so it downloads in under a second.

### pyra init — scaffold into the current directory

The `init` command is for developers who already have the Pyra CLI installed. It scaffolds a project into the **current working directory** rather than creating a new one. The directory name is used as the project name.

```bash
mkdir my-app
cd my-app
pyra init
```

If the directory is not empty, the command fails with an error. Use `--force` to scaffold anyway. Directories containing only a `.git` folder (e.g. after `git init`) are treated as empty.

| Option | Description |
|--------|-------------|
| `-t, --template <name>` | Project template: `vanilla` or `react` |
| `-l, --language <lang>` | Language: `typescript` or `javascript` |
| `--pm <manager>` | Package manager: `npm`, `pnpm`, `yarn`, or `bun` |
| `--tailwind` | Add Tailwind CSS |
| `--no-tailwind` | Skip Tailwind CSS |
| `--ui <preset>` | Tailwind preset: `basic` or `shadcn` |
| `--skip-install` | Skip dependency installation |
| `--force` | Scaffold even if the directory is not empty |
| `--silent` | Suppress banner and timing output |

**Templates:**

- **Vanilla** — a lightweight SPA with an `index.html` entry point and `src/` directory. No file-based routing or SSR.
- **React** — a full-stack app with file-based routing, SSR, layouts, and API routes.

If you don't pass flags, the CLI prompts you interactively for each choice.

```bash
# fully non-interactive: React + TypeScript + Tailwind with shadcn preset
pyra init --template react --language typescript --tailwind --ui shadcn

# vanilla JavaScript, no Tailwind
pyra init --template vanilla --language javascript --no-tailwind

# scaffold into a directory that already has files
pyra init --force --template react --language typescript --no-tailwind
```

### npm create pyra vs pyra init

| | `npm create pyra` | `pyra init` |
|---|---|---|
| Creates a new directory | Yes | No (uses current directory) |
| Requires Pyra installed | No | Yes |
| Project name | Prompted or passed as argument | Inferred from directory name |
| Framework choice | Vanilla or React | Vanilla or React |
| Language choice | TypeScript or JavaScript | TypeScript or JavaScript |
| Tailwind | Optional (none/basic/shadcn) | Optional (basic/shadcn) |
| PM selection | Interactive prompt | Auto-detected (or `--pm` flag) |
| Dependency install | Prompted (yes/no) | Automatic (or `--skip-install`) |
| Best for | New users, starting fresh | Existing workflows, git-first setups |

## pyra dev

The `dev` command launches a development server with hot module replacement. It watches the file system for changes and pushes updates to the browser instantly via WebSocket.

```bash
pyra dev
```

| Option | Description |
|--------|-------------|
| `-p, --port <number>` | Port to run on (default: 3000) |
| `-o, --open` | Open the browser when the server starts |
| `-c, --config <path>` | Path to a specific config file |
| `--mode <mode>` | Build mode: `development` or `production` (default: `development`) |
| `--verbose` | Show verbose output (config loading details, etc.) |

The dev server:

- Scans your `src/routes/` directory and builds a route table
- Renders pages with server-side rendering via the React adapter
- Runs a WebSocket server for HMR — saved files are reflected in the browser without a full reload
- Traces every request and logs timing breakdowns in your terminal
- Serves a built-in dashboard at `/_pyra` with trace inspection and route stats
- Automatically finds an available port if your requested port is already in use

### Keyboard shortcuts

When running in a TTY terminal (not in CI), the dev server supports interactive keyboard shortcuts. Press the key followed by Enter:

| Key | Action |
|-----|--------|
| `r` | Restart the server |
| `o` | Open the app in your browser |
| `c` | Clear the terminal |
| `q` | Quit the server |
| `h` | Show the shortcuts help menu |

### Examples

```bash
# start on a custom port and open the browser
pyra dev --port 4000 --open

# use a specific config file with verbose output
pyra dev --config ./config/pyra.config.ts --verbose
```

## pyra build

The `build` command produces a production-ready bundle using esbuild. It respects your `pyra.config.ts` but allows overrides through flags, which is convenient for CI and one-off experiments.

```bash
pyra build
```

| Option | Description |
|--------|-------------|
| `-o, --out-dir <path>` | Output directory (default: `dist`) |
| `--minify` | Minify the output (default: true in production) |
| `--sourcemap` | Generate sourcemaps |
| `-c, --config <path>` | Path to a specific config file |
| `--mode <mode>` | Build mode (default: `production`) |
| `--silent` | Suppress banner and timing output |

The build produces three things inside your output directory:

- `dist/client/` — browser-side JavaScript and CSS bundles
- `dist/server/` — server-side rendering bundles
- `dist/manifest.json` — a map of every route to its compiled assets

After building, the CLI prints a report showing each route's bundle size, shared chunks, and gzip size estimates. Routes exceeding the configured size warning threshold are flagged.

### Examples

```bash
# build with sourcemaps for easier debugging
pyra build --sourcemap

# build to a custom directory without minification
pyra build --out-dir build --minify=false

# silent build for CI pipelines
pyra build --silent
```

## pyra start

The `start` command serves your prebuilt app in production mode. It reads from the `dist/` directory, so you must run `pyra build` first.

```bash
pyra build && pyra start
```

| Option | Description |
|--------|-------------|
| `-p, --port <number>` | Port to run on (default: 3000) |
| `-c, --config <path>` | Path to a specific config file |
| `-d, --dist <path>` | Path to the dist directory (default: `dist`) |
| `--silent` | Suppress the startup banner |

The production server:

- Reads the build manifest to map routes to compiled assets
- Serves static assets with appropriate caching headers
- Handles SSR for server-rendered pages
- Supports conditional request tracing (controlled by `trace.production` in your config)
- Adds `Server-Timing` headers on traced responses (visible in Chrome DevTools)
- Gracefully shuts down on SIGINT/SIGTERM, finishing in-flight requests

### Keyboard shortcuts

The production server supports the same interactive shortcuts as dev (press the key followed by Enter):

| Key | Action |
|-----|--------|
| `o` | Open the app in your browser |
| `c` | Clear the terminal |
| `q` | Quit the server |
| `h` | Show the shortcuts help menu |

Note: The `r` (restart) shortcut is not available in production mode.

### Examples

```bash
# start on a specific port
pyra start --port 8080

# serve from a custom dist directory
pyra start --dist ./build
```

## pyra graph

Visualize your project's dependency graph. Analyzes `package.json` files and lockfiles to map out how your packages depend on each other. Particularly useful for monorepos and understanding your dependency tree.

```bash
pyra graph
```

| Option | Description |
|--------|-------------|
| `--format <format>` | Output format: `html`, `svg`, `png`, `mermaid`, `dot`, `json` (default: `html`) |
| `--outfile <file>` | Write output to a specific file |
| `--open` / `--no-open` | Open the result in the browser (for HTML format) |
| `--internal-only` | Show only workspace packages |
| `--external-only` | Show only external dependencies |
| `--filter <expr>` | Include only nodes matching a glob or regex |
| `--hide-dev` | Hide devDependencies |
| `--hide-peer` | Hide peerDependencies |
| `--hide-optional` | Hide optionalDependencies |
| `--max-depth <n>` | Limit how deep to follow transitive dependencies |
| `--cycles` | Highlight dependency cycles |
| `--stats` | Include size and metric information |
| `--pm <manager>` | Force a specific package manager for lockfile parsing |
| `--json` | Output raw JSON to stdout |
| `--silent` | Suppress banner and logs |

### Examples

```bash
# open an interactive HTML graph in the browser
pyra graph --open

# export as a Mermaid diagram
pyra graph --format mermaid --outfile deps.mmd

# show only workspace packages with cycle detection
pyra graph --internal-only --cycles

# JSON output for scripting
pyra graph --json > graph.json
```

## pyra doctor

Diagnose your project setup. The doctor command checks your configuration, scans your routes, and reports any issues it finds. Useful when something isn't working and you're not sure why.

```bash
pyra doctor
```

| Option | Description |
|--------|-------------|
| `-c, --config <path>` | Path to a specific config file |
| `--silent` | Suppress output |

The doctor checks:

- **Project mode** — detects whether your project is running as a **Static SPA**, **Full-Stack SSR**, or is **misconfigured**
- **Config validation** — verifies your config file exists and can be loaded
- **Entry point** — checks that your configured entry file exists on disk
- **Route scanning** — scans your routes directory and reports page count, API endpoints, layouts, and middleware files
- **Adapter detection** — confirms which adapter is active (React by default)

The output includes an explanation of your detected mode, a checklist of diagnostic results, and suggested next steps if anything needs attention.

## Troubleshooting

**Command not found** — Make sure Node.js >= 18 is installed and on your PATH. If you're using the CLI as a project dependency, run it through your package manager scripts or with `npx pyra`.

**Dev server not reflecting changes** — Check that your file is inside the watched `src/routes/` directory (for SSR projects) or matches the configured entry point. The `--verbose` flag can reveal config loading issues.

**Port already in use** — The dev server automatically finds the next available port if your requested port is taken. You'll see a warning in the startup banner. To specify a port explicitly, use `--port`.

**Build fails** — Run `pyra doctor` to check your project setup. It will flag missing config files, invalid route structures, or misconfigured paths.

**Production server doesn't match dev** — Make sure you've run `pyra build` before `pyra start`. The production server reads from compiled output in `dist/`, not your source files. If you changed code after building, rebuild first.
